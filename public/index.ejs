<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css"
			integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk="
			crossorigin="anonymous"
		/>
    <title>WebScockets</title>
    <link href="./styles.css" rel="stylesheet" />
  </head>
  <body>
    <div id="Web-socket">
      <h2>Web Chat</h2>
      <div>
        <h3>Online users</h3>
        <div id="users-online"></div>
      </div>
      <div id="chat-window">
        <div id="chatBox" data-testid="message-box" >
      </div>
        <div id="userTyping"></div>
      </div>
      <div>
        <form>
          <input id="user" type="text" placeholder="User Name" data-testid="nickname-box" />
          <input id="user-message-field" type="text" placeholder="Message" />
        </form>
        <button type="button" id="save-nick" data-testid="nickname-save" >Salvar Nickname</button>
        <button id="send" data-testid="send-button" >Send</button>
      </div>
    <script src="http://localhost:3000/socket.io/socket.io.js"></script>
    <script>

      const socket = io();

      // Query DOM
      const userMsgField = document.getElementById('user-message-field');
      const userName = document.getElementById('user').value;
      const btn = document.getElementById('send');
      const btnToSaveNickName = document.getElementById('save-nick');
      const chatBox = document.getElementById('chatBox');
      const userTyping = document.getElementById('userTyping');
      const usersList = document.getElementById('users-online');

      let userId;
      let nickName;

      socket.on(
        'connected',
        (id, nick) => {
          userId = id;
          nickName = nick;
          console.log(`User ${nickName} connected`)
        },
      );

      socket.on('userConnected', (id, nick) => {
        const span = document.createElement('span');
        span.innerHTML = `<span>${nick}</span>`;
        chatBox.appendChild(span);
      });

      btnToSaveNickName.addEventListener('click', function () {
        nickName = userName;
        console.log('Nickname logged is', nickName);
        socket.emit('saveNickName', nickName, userId);
      });

      socket.on('usersOnline', (arrayOfUsers) => {
        arrayOfUsers.forEach((user) => {
          usersList.innerHTML += `<li data-testid="online-user" >${user.nickName}</li>`;
        });
      });

      btn.addEventListener('click', function () {
        socket.emit('message', {
          nickName: userName,
          chatMessage: userMsgField.value,
        });
        userMsgField.value = '';
      });

      // userMsgField.addEventListener('keypress', function () {
      //   socket.emit('typing', userTyping.value);
      // });

      // socket.on('privateChat', (nick) => {
      //   nickName = nick;
      //   const tagH6 = document.createElement('h6');
      //   tagH6.innerText = `Bem vindo ${nickName}`;
      //   chatBox.appendChild(tagH6);
      // });

      // socket.on('typing', function (data) {
      //   feedback.innerHTML = '<p><em>' + data + ' is typing a message...</em></p>';
      // });

      // socket.on('disconect');

    </script>
  </body>
</html> -->
